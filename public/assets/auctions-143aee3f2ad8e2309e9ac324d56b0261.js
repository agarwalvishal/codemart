function reloadContents(){reload_allowed&&$.get("/auctions.json",function(a){panic_mode=!1,$("#balance").html(a.balance),balance=a.balance,a.last_archived_auction_present&&($(".last_archived_auction_problem_name").html(a.last_archived_auction.problem.name),$(".last_archived_auction_winning_bidder_username").html(a.last_archived_auction.winning_bidder.username),$("#archived_info").show()),a.active_auctions.length!=$("#active_auctions .panel").length&&(panic_mode=!0),a.inactive_auctions.length!=$("#inactive_auctions .panel").length&&(panic_mode=!0),panic_mode||(a.active_auctions.forEach(function(a){panic_mode||(the_panel=$("#active_auctions .panel[data-id='"+a.id+"']"),0==the_panel.length?panic_mode=!0:(the_panel.find(".current_price").html(a.current_price),the_panel.find(".reward").html(a.problem.reward),the_panel.find(".bid-button").data("allowed",a.bidding_allowed),the_panel.find(".buy-button").data("allowed",a.buying_allowed),the_panel.find("input[type=number]").data("min",Math.min(a.current_price+10,a.buy_it_now_price-10)),Math.min(a.current_price+10,a.buy_it_now_price-10)>parseInt(the_panel.find("input[type=number]").val())&&the_panel.find("input[type=number]").val(Math.min(a.current_price+10,a.buy_it_now_price-10)),a.timer_running?(the_panel.find(".time_left_wrapper").show(),the_panel.find(".time_left").html("&nbsp;"+a.time_left),the_panel.find(".winning_bidder").html("&nbsp;"+a.winning_bidder.username)):(the_panel.find(".time_left_wrapper").hide(),the_panel.find(".time_left").html(""),the_panel.find(".winning_bidder").html(""))))}),a.inactive_auctions.forEach(function(a){panic_mode||(the_panel=$("#inactive_auctions .panel[data-id='"+a.id+"']"),0==the_panel.length&&(panic_mode=!0))})),panic_mode&&(console.log("In panic mode"),$("#active_auctions").children().remove(),a.active_auctions.forEach(function(a){$("#active_auctions").append('<div class="panel panel-primary" data-id="'+a.id+'">            <div class="panel-heading name">'+a.problem.name+'</div>            <div class="panel-body">              <b>Read statement:</b>              <span class="statement_link"><a href="'+a.problem.url+'" target="_blank">Click Here</a></span>              <br>                            <b>Current Price:</b>              <span class="current_price">'+a.current_price+'</span> coins              <br>                            <b>Reward:</b>              <span class="reward">'+a.problem.reward+"</span> coins              <br>"+(a.timer_running?'<span class="time_left_wrapper"><b>Winning bidder:</b><span class="winning_bidder">'+a.winning_bidder.username+'</span><br><b>Time left to bid:</b><span class="time_left">'+a.time_left+"</span> seconds<br></span>":'<span class="time_left_wrapper" style="display: none;"><b>Winning bidder:</b><span class="winning_bidder"></span><br><b>Time left to bid:</b><span class="time_left"></span> seconds<br></span>')+'<br>              <b>Make a Bid:</b><br><br>                            <input type="number" name="amount" class="form-control" value="'+(a.current_price+10)+'" data-min="'+(a.current_price+10)+'" data-max="'+(a.buy_it_now_price-10)+'" readonly><br>                            <div class="btn-group" role="group" aria-label="add-value">                <button type="button" class="btn btn-primary add" data-value="10">+10</button>                <button type="button" class="btn btn-primary add" data-value="100">+100</button>                <button type="button" class="btn btn-primary add" data-value="1000">+1000</button>              </div>                            <div class="btn-group" role="group" aria-label="sub-value">                <button type="button" class="btn btn-danger sub" data-value="10">-10</button>                <button type="button" class="btn btn-danger sub" data-value="100">-100</button>                <button type="button" class="btn btn-danger sub" data-value="1000">-1000</button>              </div>                            <a class="btn btn-warning bid-button" data-allowed="'+a.bidding_allowed+'">Bid the above amount</a>              <a class="btn btn-success buy-button" data-allowed="'+a.bidding_allowed+'">Buy it now for '+a.buy_it_now_price+" coins</a>            </div>          </div>                    <br>")}),$("#inactive_auctions").children().remove(),a.inactive_auctions.forEach(function(a){$("#inactive_auctions").append('<div class="panel panel-default" data-id="'+a.id+'">            <div class="panel-heading name">'+a.problem.name+'</div>            <div class="panel-body">              <b>Read statement:</b>              <span class="statement_link"><a href="'+a.problem.url+'" target="_blank">Click Here</a></span>              <br>                            <b>Base Price:</b>              <span class="current_price">'+a.current_price+'</span> coins              <br>                            <b>Reward:</b>              <span class="reward">'+a.problem.reward+"</span> coins            </div>          </div>                    <br>")}))})}var panic_mode=!1,reload_allowed=!0,balance;$(function(){window.setInterval(function(){reloadContents()},1e3),$("#active_auctions").on("click",".add",function(){field=$(this).parent().parent().find("input[type=number]"),field.val(parseInt(field.val())+$(this).data("value")),parseInt(field.val())>balance&&field.val(balance),parseInt(field.val())>field.data("max")&&field.val(field.data("max"))}),$("#active_auctions").on("click",".sub",function(){field=$(this).parent().parent().find("input[type=number]"),field.val(parseInt(field.val())-$(this).data("value")),parseInt(field.val())<field.data("min")&&field.val(field.data("min"))}),$("#active_auctions").on("click",".bid-button",function(){1==$(this).data("allowed")?(field=$(this).parent().parent().find("input[type=number]"),id=parseInt($(this).parent().parent().data("id")),amount=parseInt(field.val()),reload_allowed=!1,$.post("/auctions/"+id+"/bid.json",{amount:amount}).done(function(a){a.success===!1&&alert(a.message),console.log(reload_allowed),reload_allowed=!0,console.log(reload_allowed)})):alert("You are not allowed to bid on this!")}),$("#active_auctions").on("click",".buy-button",function(){1==$(this).data("allowed")?(field=$(this).parent().parent().find("input[type=number]"),id=parseInt($(this).parent().parent().data("id")),amount=parseInt(field.val()),reload_allowed=!1,$.post("/auctions/"+id+"/buy.json",{}).done(function(a){a.success===!1&&alert(a.message),reload_allowed=!0})):alert("You are not allowed to buy this!")}),balance=parseInt($("#balance").html())});